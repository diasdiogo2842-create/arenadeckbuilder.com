<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Clash Deck Rater</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
    }
    input[type="text"] {
      padding: 10px;
      width: 80%;
      border-radius: 5px;
      border: none;
      background-color: #333;
      color: white;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      background-color: #007bff;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    .result {
      margin-top: 30px;
      font-size: 1.2em;
    }
    .category {
      margin-bottom: 10px;
    }
    .godly {
      font-weight: bold;
      background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow 4s linear infinite;
    }
    @keyframes rainbow {
      0% {filter: hue-rotate(0deg);}
      100% {filter: hue-rotate(360deg);}
    }
    .suggestion {
      margin-top: 20px;
      color: #ff7777;
    }
  </style>
</head>
<body>
  <h1>Deck Check AI</h1>
  <p>Paste your Clash Royale deck link below:</p>
  <input id="deckLink" type="text" placeholder="https://link.clashroyale.com/deck/en?deck=..." />
  <br>
  <button onclick="rateDeck()">Analyze Deck</button>

  <div class="result" id="resultText"></div>
  <div class="suggestion" id="swapSuggestions"></div>

  <script>
    const cardMap = {
      "26000000": "Knight",
      "26000001": "Archers",
      "26000002": "Goblins",
      "26000003": "Giant",
      "26000004": "P.E.K.K.A",
      "26000005": "Minions",
      "26000006": "Balloon",
      "26000007": "Witch",
      "26000008": "Barbarians",
      "26000009": "Golem",
      "26000010": "Skeletons",
      "26000011": "Valkyrie",
      "26000012": "Mini P.E.K.K.A",
      "26000013": "Musketeer",
      "26000014": "Baby Dragon",
      "26000015": "Prince",
      "26000016": "Wizard"
    };

    const offenseCards = ["Giant", "Balloon", "Golem", "P.E.K.K.A", "Hog Rider", "Miner", "Royal Giant", "Prince"];
    const defenseCards = ["Cannon", "Tornado", "Mini P.E.K.K.A", "Knight", "Valkyrie", "Archers", "Musketeer"];
    const winConditions = ["Golem", "Hog Rider", "Balloon", "Royal Giant", "X-Bow", "Mortar", "Miner", "Graveyard"];

    const suggestions = {
      offense: ["Prince", "Giant", "Balloon", "Hog Rider"],
      defense: ["Mini P.E.K.K.A", "Valkyrie", "Musketeer", "Cannon"],
      win: ["Hog Rider", "Miner", "Golem", "Royal Giant"]
    };

    function extractCardIDs(link) {
      const match = link.match(/deck=([\d;]+)/);
      if (!match) return [];
      return match[1].split(";");
    }

    function getCardNames(cardIDs) {
      return cardIDs.map(id => cardMap[id]).filter(Boolean);
    }

    function scoreCategory(deck, categoryList) {
      let score = deck.filter(card => categoryList.includes(card)).length;
      if (score >= 3) return "Godly";
      if (score === 2) return "Good";
      if (score === 1) return "Mid";
      return "Bad";
    }

    function getStyledGrade(grade) {
      if (grade === "Godly") {
        return `<span class="godly">${grade}</span>`;
      }
      return grade;
    }

    function suggestSwaps(deck, category, categoryList) {
      let present = deck.filter(card => categoryList.includes(card));
      if (present.length >= 2) return null;

      const needed = suggestions[category].filter(card => !deck.includes(card));
      return needed.slice(0, 2); // Suggest top 2
    }

    function rateDeck() {
      const link = document.getElementById("deckLink").value.trim();
      const ids = extractCardIDs(link);
      const deck = getCardNames(ids);

      if (deck.length !== 8) {
        document.getElementById("resultText").innerHTML = "Invalid deck link or unsupported cards.";
        return;
      }

      const offense = scoreCategory(deck, offenseCards);
      const defense = scoreCategory(deck, defenseCards);
      const wincon = scoreCategory(deck, winConditions);

      document.getElementById("resultText").innerHTML = `
        <div class="category">Offense: ${getStyledGrade(offense)}</div>
        <div class="category">Defense: ${getStyledGrade(defense)}</div>
        <div class="category">Win Condition: ${getStyledGrade(wincon)}</div>
      `;

      let suggestionText = "";
      const offenseSwap = suggestSwaps(deck, "offense", offenseCards);
      const defenseSwap = suggestSwaps(deck, "defense", defenseCards);
      const winSwap = suggestSwaps(deck, "win", winConditions);

      if (offenseSwap || defenseSwap || winSwap) {
        suggestionText += "<b>Suggested Improvements:</b><br>";
        if (offenseSwap) suggestionText += `üîÅ Add for Offense: ${offenseSwap.join(", ")}<br>`;
        if (defenseSwap) suggestionText += `üõ°Ô∏è Add for Defense: ${defenseSwap.join(", ")}<br>`;
        if (winSwap) suggestionText += `üèÜ Add for Win Condition: ${winSwap.join(", ")}`;
      } else {
        suggestionText = "‚úÖ This deck is well-balanced!";
      }

      document.getElementById("swapSuggestions").innerHTML = suggestionText;
    }
  </script>
</body>
</html>
